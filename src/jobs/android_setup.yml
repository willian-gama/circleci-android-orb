description: Initial setup to download android and ruby (fastlane) dependencies.

parameters:
  resource_class:
    type: enum
    description: Configure the executor resource class
    enum: [medium, large, xlarge]
    default: large

  build_variant:
    type: enum
    description: "Define build variant such as: debug, fullDebug"
    enum: [debug, fullDebug]

executor:
  name: android_executor
  resource_class: << parameters.resource_class >>

steps:
  - checkout
  - generate_user_properties
  - generate_gradle_cache_key
  - restore_gradle_cache
  - android/restore-build-cache
  - run:
      name: Download android dependencies
      command: <<include(scripts/download_android_dependencies.sh)>>
  - run:
      name: Assemble build
      environment:
        BUILD_VARIANT: << parameters.build_variant >>
      command: <<include(scripts/assemble_build.sh)>>
  - save_gradle_cache
  - android/save-build-cache
  - persist_to_workspace:
      root: ~/
      paths:
        - src
        - .android