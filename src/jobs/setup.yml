description: Initial setup to download dependencies

executor: android_executor

parameters:
  with_screenshot_tests:
    type: boolean
    description: Determine if screenshot tests should be tested alongside unit tests

steps:
  - checkout
  - run:
      name: Clone fastlane config
      command: <<include(scripts/clone_fastlane_config.sh)>>
  - run:
      name: Generate user.properties
      command: <<include(scripts/generate_user_properties.sh)>>
  - restore_gradle_cache
  - restore_gems_cache
  - run:
      name: Download android dependencies
      command: ./gradlew androidDependencies
  - run:
      name: Download ruby dependencies
      command: |
        gem install bundler
        bundle check || bundle install --path vendor/bundle
  - save_cache:
      name: Saving gradle cache
      key: gradle-{{ checksum "gradle_checksum.txt" }}
      paths:
        - ~/.gradle
        - ~/.m2
  - save_cache:
      name: Saving gems cache
      key: gems-{{ checksum "Gemfile.lock" }}
      paths:
        - vendor/bundle
  - persist_to_workspace:
      root: ~/
      paths:
        - src