description: Initial setup to download android and ruby (fastlane) dependencies.

executor:
  name: android_executor
  resource_class: medium

steps:
  - checkout
  - run:
      name: Clone fastlane config
      command: <<include(scripts/clone_fastlane_config.sh)>>
  - run:
      name: Generate user.properties
      command: <<include(scripts/generate_user_properties.sh)>>
  - generate_gradle_cache_key
  - restore_gradle_cache
  - restore_gems_cache
  - run:
      name: Download android dependencies
      command: ./gradlew androidDependencies
  - run:
      name: Download ruby dependencies (fastlane)
      command: <<include(scripts/download_ruby_dependencies.sh)>>
  - save_cache:
      name: Saving gradle cache
      key: gradle-{{ checksum "gradle_checksum.txt" }}
      paths:
        - ~/.gradle
        - ~/.m2
  - save_cache:
      name: Saving gems cache
      key: gems-{{ checksum "Gemfile.lock" }}
      paths:
        - vendor/bundle
  - persist_to_workspace:
      root: ~/
      paths:
        - src